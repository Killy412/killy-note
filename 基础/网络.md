## 网络分层TCP/IP

1. 应用层,代表HTTP/DNS/FTP. 定义的是应用进程间的通信和交互规则.

2. 传输层,代表TCP/UDP. 主要任务是负责向两台主机进程之间的通信提供通用的数据传输服务.

  TCP: 面向连接的可靠传输协议. 传输效率偏低.
  UDP: 无连接的传输协议.尽可能的传输数据. 传输效率较高.

3. 网络层,代表IP. 两个电脑之间的通信需要经过很多链路层,也可能经过很多通信子网.网络层的任务是选择合适的网间路由和交换节点,确保数据及时传输.

4. 链路层. 两台主机之间的数据传输,总是在一段一段的链路上传输的,这就需要使用专门的链路协议.

5. 物理层.实现相邻计算机节点的比特流透明传输.

## TCP三次握手和四次挥手.

### 握手过程

客户端.发送带有SYN标志的数据包-一次握手
服务端.发送带有SYN/ACK的数据包到客户端-二次握手
客户端.发送带有ACK标识的数据包到服务端-三次握手

三次握手的目的是为了建立可靠的通信信道.
一次握手: server确认对方发送,自己接收正常
二次握手: client确认自己发送/接收正常,对面发送/接收正常,server确认对方发送,自己接受正常
三次握手: server确认自己发送,对面接收正常
主要就是双方都确认自己和对方发送/接收都是正常的.

### 挥手过程

客户端. 发送FIN,关闭客户端到服务端的数据传送
服务端. 收到FIN,发回一个ACK,确认序号为收到的序号加一.
服务端. 发送FIN,关闭服务端到客户端的数据传送.
客户端. 受到FIN,发回一个ACK,确认序号为收到的序号加一.

## TCP如何保证传输可靠性

1. 数据被tcp分成最适合发送的数据段.
2. tcp给每个数据进行编号,接收方对数据包进行重组,有序发给应用层.
3. 校验和.tcp将保持首部和数据的校验和. 端到端的检验和,目的是检测数据在传输过程中的任何变化.如果收到段的检验和有差错,tcp会丢失这个报文段和不确认收到这个报文段.
4. tcp的接收端会丢掉重复数据
5. 流量控制.tcp连接的每一方都有固定大小的缓冲空间,tcp接收端只允许接收缓冲空间可容纳大小的数据包,当接收方来不及处理时,能提示发送方降低发送的频率,防止数据丢失.tcp使用的流量控制协议是可变大小的滑动窗口协议.
6. 拥塞控制. 当网络拥塞时,减少数据的发送.
7. ARQ协议,也是为了实现可靠传输的.基本原理是每发完一个分组就停止发送,等待确认后,再发送下一个分组.
8. 超时重传,当tcp发送一个段后,启动一个定时器,等待目的地端确认受到这个段,如果没有及时收到一个确认,发送端会重新发送.

### ARQ协议

自动重传(Automatic Repeat-reQuest)请求是数据链路层和传输层的数据纠正协议之一.他通过使用确认和超时这两个机制,实现在不可靠的基础上实现可靠传输.如果发送方没有收到确认消息,通常会自动重传.ARQ包括停止等待ARQ协议和连续ARQ协议.

1. 停止等待ARQ协议

基本原理是每发送一个分组就停止发送,等待确认消息,如果超过超时时间还没收到确认消息,就重新发送.
接收方收到重复消息会丢弃,但同时也会发送确认消息.

2. 连续ARQ协议

可提高信道使用率.发送方维持一个发送窗口,凡位于发送窗口发的分组可连续发送出去.不需要等待对方确认.接收方采用累计确认,对按序到达的最后一个分组发送确认,表示这个分组为止所有的分组都发送成功了.
优点是信道利用率高.
缺点是无法向发送方反映出接收方已经正确收到的分组信息.

#### 滑动窗口和流量控制

TCP利用滑动窗口实现流量控制.流量控制是控制发送方发送速率,保证接收方来得及接收.接收方发送的确认报文的窗口字段可以控制发送方的窗口大小,如果设置为0,发送方不能发送东西.
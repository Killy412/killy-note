## TCP三次握手和四次挥手

### 三次握手

主要目的是确保双方都可以正确的发送和接收信息

1. client给server发送带有syn标识的数据包- 一次握手
2. server给client发送带有syn/ack标识的数据包 - 二次握手
3. client给server发送带有ack标识的数据包  - 三次握手

#### 第二次握手传回了syn,为什么还要传ack?

传回syn是为了告诉发送端,接收到的信息是你发送的信号. 传回ack是为了建立并确认从服务端到客户端的通信.

#### 使用两次握手是否可行

防止已经失效的连接请求又被发送到服务器,从而产生错误.

如果使用的是两次握手建立连接，假设有这样一种场景，客户端发送了第一个请求连接并且没有丢失，只是因为在网络结点中滞留的时间太长了，由于TCP的客户端迟迟没有收到确认报文，以为服务器没有收到，此时重新向服务器发送这条报文，此后客户端和服务器经过两次握手完成连接，传输数据，然后关闭连接。此时此前滞留的那一次请求连接，网络通畅了到达了服务器，这个报文本该是失效的，但是，两次握手的机制将会让客户端和服务器再次建立连接，这将导致不必要的错误和资源的浪费。

如果采用的是三次握手，就算是那一次失效的报文传送过来了，服务端接受到了那条失效报文并且回复了确认报文，但是客户端不会再次发出确认。由于服务器收不到确认，就知道客户端并没有请求连接。

### 四次挥手

断开一个tcp连接需要四次挥手

1. 客户端发送一个FIN,用来关闭到服务器的数据传送
2. 服务器收到FIN,发回一个ACK,确认序号为收到的序号+1
3. 服务器关闭与客户端的连接,发送一个FIN给客户端
4. 客户端发回ACK报文确认,并将确认序号设置为收到序号+1.

### TCP如何保证可靠传输

- 应用数据被分割成TCP认为合适发送的数据块
- 

## TCP和UDP区别

UDP在传输数据前不需要建立连接,接收方收到udp报文数据后,也不需要给出任何确认. 虽然udp连接是不可靠的,但在某些地方是有效的工作方式,例如语音/视频/直播等.

TCP是面向连接的服务. 在传输数据前必须建立连接,传输完成后要释放连接. TCP提供可靠的,面向连接的传输服务(可靠体现在传输数据前,会通过tcp三次握手建立连接,传输数据时,还会有确认,重试拥塞控制机制,传输完成,会断开连接,节省资源),同时会增加很多开销.TCP 一般用于文件传输、发送和接收邮件、远程登录等场景。
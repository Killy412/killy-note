## TCP三次握手和四次挥手

### 三次握手

主要目的是确保双方都可以正确的发送和接收信息

1. client给server发送带有syn标识的数据包- 一次握手
2. server给client发送带有syn/ack标识的数据包 - 二次握手
3. client给server发送带有ack标识的数据包  - 三次握手

#### 第二次握手传回了syn,为什么还要传ack?

传回syn是为了告诉发送端,接收到的信息是你发送的信号. 传回ack是为了建立并确认从服务端到客户端的通信.

#### 使用两次握手是否可行

防止已经失效的连接请求又被发送到服务器,从而产生错误.

如果使用的是两次握手建立连接，假设有这样一种场景，客户端发送了第一个请求连接并且没有丢失，只是因为在网络结点中滞留的时间太长了，由于TCP的客户端迟迟没有收到确认报文，以为服务器没有收到，此时重新向服务器发送这条报文，此后客户端和服务器经过两次握手完成连接，传输数据，然后关闭连接。此时此前滞留的那一次请求连接，网络通畅了到达了服务器，这个报文本该是失效的，但是，两次握手的机制将会让客户端和服务器再次建立连接，这将导致不必要的错误和资源的浪费。

如果采用的是三次握手，就算是那一次失效的报文传送过来了，服务端接受到了那条失效报文并且回复了确认报文，但是客户端不会再次发出确认。由于服务器收不到确认，就知道客户端并没有请求连接。

### 四次挥手

断开一个tcp连接需要四次挥手

1. 客户端发送一个FIN,用来关闭到服务器的数据传送
2. 服务器收到FIN,发回一个ACK,确认序号为收到的序号+1
3. 服务器关闭与客户端的连接,发送一个FIN给客户端
4. 客户端发回ACK报文确认,并将确认序号设置为收到序号+1.

### TCP如何保证可靠传输

- 应用数据被分割成TCP认为合适发送的数据块
- TCP给发送的每个包进行编号,接收方对数据包进行排序,把数据有序的送到应用层.
- TCP接收方会丢弃重复的数据
- 拥塞控制,当网络阻塞时,减少数据的发送.
- 超时重传,当TCP发出一个段时,启动一个定时器,等待目的地确认收到这个报文段. 如果不能即时收到这个确认消息,会重新发送
- ARQ协议: 为了实现可靠传输的目的,基本原理是每发完一个分组就停止发送,等待对方确认.在收到确认后再发送下一分组.

### ARQ协议

(automatic repeat-request)自动重传请求是OSI模型中数据链路层和传输层的错误纠正协议之一.通过使用确认和超时这两个机制,在不可靠的服务上实现可靠的数据传输.如果发送方在发送完数据没有收到确认帧的情况下,会重新发送.ARQ包括连续ARQ协议和停止等待ARQ协议.

#### 停止等待ARQ

停止等待就是发送方在发送一组数据就停止发送,等待对方确认(回复ACK). 如果过了一段时间还是没有收到ack确认,就重新发送,直到收到确认ack后再发送下一组.


#### 连续ARQ

连续ARQ协议可提高信道利用率.发送方维持一个发送窗口,凡位于发送窗口内的分组都可以连续发送出去,而不需要等待对方确认.接收方一般采用累计确认,对按序到达的最后一个分组发送确认,表明到这个组的所有分组都已经确认收到.

## TCP和UDP区别

UDP在传输数据前不需要建立连接,接收方收到udp报文数据后,也不需要给出任何确认. 虽然udp连接是不可靠的,但在某些地方是有效的工作方式,例如语音/视频/直播等.

TCP是面向连接的服务. 在传输数据前必须建立连接,传输完成后要释放连接. TCP提供可靠的,面向连接的传输服务(可靠体现在传输数据前,会通过tcp三次握手建立连接,传输数据时,还会有确认,重试拥塞控制机制,传输完成,会断开连接,节省资源),同时会增加很多开销.TCP 一般用于文件传输、发送和接收邮件、远程登录等场景。


## 常见题目

### URL和URI的区别是什么

- URL是统一资源定位符,可以提供该资源的访问路径.是一种具体的URI.
- URI是统一资源标识符,可以唯一标识一个资源.

### 浏览器输入一个url地址,发生了什么

1. 浏览器使用dns协议查找域名对应的ip地址(查找浏览器缓存-> 查找路由器缓存 -> 查找dns缓存)
2. 经过三次握手,与服务器建立tcp连接
3. 浏览器向web服务器发送一个http请求(tcp协议)
4. 服务器处理请求
5. 服务器返回一个html响应
6. 浏览器解析并显示

### HTTP1.0和1.1的区别是什么

1. http1.0使用的是短连接,每次请求都需要重新建立一次连接. 每次建立断开连接都需要三次握手和四次挥手.开销比较大. http1.1中默认使用的是长连接. 默认开启 Connection:keep-alive
2. Http1.1新增了24个错误状态响应码,
3. 缓存处理: 1.0中主要使用header中的if-Modified-since,Expires作为缓存判断的标准,1.1中引入了更多的缓存控制策略如Entity-tag,if-unModified-since,if-Match,if-None-Match等更多可供选择的缓存控制策略.
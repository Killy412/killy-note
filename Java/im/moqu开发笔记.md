# moqu开发

### 基本
- 在线用户:redis
- 静态资源:OSS
- 消息持久化 mysql
- 消息发送: netty+mq
- im管理后台 

### 概念
- 消息队列:新写入消息的缓冲队列,消息系统的前置消息存储
- 消息处理: 消息的消费处理服务器,异步消费**消息队列**的消息数据,做持久化和写扩散
- 消息存储和索引库:持久化存储消息,每个会话对应一个TimeLine进行消息存储,
- 消息同步库,写扩散形式同步消息,同步库内消息不需要永久保存,对消息做一个生命周期

> 1. 客户端发送消息,消息体携带消息ID(用于去重),逻辑时间戳(用于排序),消息类型(文本/图片),消息体等内容.
> 2. 消息先写入消息队列,作为底层存储的临时缓冲区,消息队列的消息由消息处理服务器处理,允许乱序消费
> 3. 消息处理服务器对消息先存储后同步,先写入发件箱timeLine(存储库),后写扩散至各个接收端的收件箱(同步库).
> 对于在线的设备,可以由消息服务器主动推送至在线设备.对于离线设备,登陆后会主动从服务端拉去消息.每个设备会在本地保留最新一条消息的id,拉取该id以后的所有消息.

#### 疑问

- 做消息漫游么?